<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../oc-core-utils/oc-api-provider-behaviour.html">

<dom-module id="oc-user-api">

  <template>
    <iron-ajax id="getLoggedInUser"></iron-ajax>
  </template>

  <script>
    (function () {
      Polymer({
        is: 'oc-user-api',
        behaviors: [OC.Behaviours.ApiProvider],

        /**
         * Get the currently logged in user
         *
         * @returns {Promise}
         */
        getLoggedInUser: function() {
          this.$.getLoggedInUser.url = this._url('users/logged_in');
          return this._generateRequest(this.$.getLoggedInUser);
        },

        /**
         * Get the Lats/Longs for an address
         *
         * @param {{ String, name: String, streetNumber: String, streetName: String, complex: String, suburb: String, city: String, postalCode: String, province: String, country: String }} address
         * @return {Promise}
         */
        getGeoLocation: function(address) {
          this.$.getGeoLocation.url = this._url('users/geocode');
          this.$.getGeoLocation.method = "PUT";
          this.$.getGeoLocation.contentType = "application/json";
          this.$.getGeoLocation.body =
          {
            latitude: null,
            name: address.name,
            streetNumber: address.streetNumber,
            streetName: address.streetName,
            complex: address.complex,
            suburb: address.suburb,
            city: address.city,
            postalCode: address.postalCode,
            note: null,
            favourite: false,
            id: 0,
            enabled: false,
            longitude: null
          };
          return this._generateRequest(this.$.getGeoLocation);
        }

      });
    })();
  </script>

</dom-module>
